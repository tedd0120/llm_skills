## 上下文

`teams-group-members` 当前能力聚焦单群查询。新需求要求在不破坏现有调用方式的前提下，新增批量同步与落盘能力，并保持实现简单可维护。

## 目标 / 非目标

- 目标：
  - 支持通过入参指定数据保存路径。
  - 支持从 `.env` 读取固定群组列表并批量抓取。
  - 对多群成员结果做并集去重后统一输出。
- 非目标：
  - 不引入数据库或长期状态存储。
  - 不改变现有成员字段结构定义。
  - 不处理跨组织账号映射等复杂主数据治理问题。

## 决策

- 决策 1：新增环境变量 `TEAMS_GROUP_CODES` 保存固定群组列表。
  - 格式为逗号分隔字符串（可容忍空格），例如：`groupA,groupB,groupC`。
- 决策 2：批量去重主键使用 `id`（员工工号）。
  - 若 `id` 为空则回退到 `userName`；若两者都为空则跳过该条记录去重键构建失败的合并，仅保留首次出现记录。
- 决策 3：保存路径由调用方传入。
  - 传入路径时必须写入 JSON 文件；若上级目录不存在则自动创建。
- 决策 4：CLI 支持两种模式。
  - 单群模式：显式传 `--group`。
  - 批量模式：不传 `--group` 时读取 `TEAMS_GROUP_CODES` 并执行聚合更新。

## 风险 / 权衡

- 同一成员在不同群组记录若存在字段差异，采用“首次记录优先”策略实现最小复杂度，可能忽略后续群组中的差异字段。
- `TEAMS_GROUP_CODES` 配置错误会导致批量模式失败，因此需要明确错误提示和示例配置。

## 迁移计划

1. 先保持 `fetch_group_members` 单群接口兼容。
2. 增加批量入口函数与保存能力。
3. 更新 CLI 参数和文档，验证新旧调用路径均可工作。
