# group-members-skill 规范

## 目的
待定 - 由归档变更 update-group-members-batch-sync 创建。归档后请更新目的。
## 需求
### 需求：支持通过入参指定成员数据保存路径

成员抓取流程**必须**支持由调用方传入保存路径，并将结果以 JSON 格式写入目标文件。

#### 场景：函数调用指定保存路径

- 当调用方在函数入参中提供 `save_path`
- 系统**必须**将成员数据写入该路径对应文件
- 当上级目录不存在时，系统**必须**自动创建目录

#### 场景：CLI 指定保存路径

- 当用户运行脚本并提供 `--output` 参数
- 系统**必须**将结果写入 `--output` 对应文件

### 需求：支持从环境变量读取固定群组列表

系统**必须**支持从 `.env` 读取 `TEAMS_GROUP_CODES` 作为批量抓取的固定群组列表。

#### 场景：按固定群组列表批量抓取

- 当未指定 `--group` 且 `.env` 中存在 `TEAMS_GROUP_CODES`
- 系统**必须**按列表中的每个群组依次抓取成员数据

#### 场景：批量模式缺少群组列表配置

- 当未指定 `--group` 且 `.env` 中缺少 `TEAMS_GROUP_CODES`
- 系统**必须**给出明确错误提示并终止批量抓取

### 需求：多群成员结果并集去重

批量抓取时，系统**必须**对所有群组成员结果取并集并去重后输出统一列表。

#### 场景：同一成员存在于多个群组

- 当同一成员在多个群组都被抓取到
- 系统**必须**在最终输出中仅保留一条记录
- 去重键**必须**优先使用 `id`，`id` 为空时回退 `userName`

### 需求：从环境变量加载敏感配置

脚本启动时**必须**从 `.env` 文件加载 `TEAMS_AUTHORIZATION` 和 `TEAMS_COOKIE`，**禁止**在代码中硬编码敏感信息。

#### 场景：环境变量已配置
- 当用户已在 `.env` 配置有效凭据时
- 脚本**必须**正常执行并返回群组成员数据

#### 场景：环境变量缺失
- 当 `.env` 中缺少必需配置时
- 脚本**必须**抛出明确错误提示，指明缺少哪些变量

---

### 需求：获取并解析群组成员信息

**必须**提供 `fetch_group_members(group_code)` 函数，根据群组代码调用 API 并返回解析后的成员列表。

每个成员记录**必须**包含以下字段：
- `name` - 姓名
- `id` - 员工工号
- `userName` - 登录账号
- `role` - 角色（1=群主, 4=普通成员）
- `deptName` - 部门名称
- `deptCode` - 部门编码
- `superior` - 直属上级
- `bpName` - 对应BP
- `workPlaceName` - 办公地点
- `sex` - 性别（0=男, 1=女）
- `portrait_url` - 头像链接
- `create_dt` - 加入时间

#### 场景：获取有效群组的成员
- 调用 `fetch_group_members("FhSnheH3T_grT5yzxqVS5o")`
- **必须**返回包含所有成员详细信息的字典列表
- `extra` 字段中的嵌套 JSON **必须**被解析并扁平化到成员记录中

#### 场景：群组代码无效
- 当传入无效的群组代码时
- **必须**返回空列表并打印错误提示

---

### 需求：CLI 入口支持

脚本**必须**可通过命令行直接运行，**必须**支持 `--group` 参数指定群组代码。

#### 场景：命令行调用
- 运行 `python fetch_group_members.py --group FhSnheH3T_grT5yzxqVS5o`
- **必须**输出格式化的成员列表到控制台

